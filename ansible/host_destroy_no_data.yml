---
- hosts: all
  tasks:
    - name: get running non-data container ids
      shell: docker ps | grep '{{ prefix }}' | grep -v '\-data' | awk '{print $1}'
      register: ps_result
      ignore_errors: no
    - name: stop/kill all non-data kolla containers
      shell: docker '{{ destroy_type | default("kill") }}' "{{ item }}"
      ignore_errors: no
      with_items: ps_result.stdout_lines
    - name: get all non-data container ids
      shell: docker ps -a | grep '{{ prefix }}' | grep -v '\-data' | awk '{print $1}'
      register: ps_a_result
      ignore_errors: no
    - name: remove non-data docker containers
      shell: docker rm "{{ item }}"
      ignore_errors: no
      with_items: ps_a_result.stdout_lines
